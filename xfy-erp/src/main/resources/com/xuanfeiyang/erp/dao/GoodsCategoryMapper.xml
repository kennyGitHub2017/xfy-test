<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.xuanfeiyang.erp.dao.GoodsCategoryDao">
	
	<!-- 基础字段 -->
	<resultMap type="GoodsCategory" id="BaseResultMap">
		<id property="id" column="id" />
		<result property="name" column="NAME" />
		<result property="code" column="CODE" />
		<result property="parentId" column="PARENT_ID" />
		<result property="note" column="NOTE" />
		<result property="createdTime" column="CREATED_TIME" />
		<result property="lastUpdatedTime" column="LAST_UPDATED_TIME" />
	</resultMap>
	
	<!-- 带有孩子列表 -->
	<resultMap type="GoodsCategory" id="ResultMapWithChildren" extends="BaseResultMap">
		<collection property="childs" column="ID" select="findChildrenByParentId" />
	</resultMap>
	
	<!-- 带有父节点 -->
	<resultMap type="GoodsCategory" id="ResultMapWithParent" extends="BaseResultMap">
		<association property="parent" column="PARENT_ID" select="loadWithParents" />
	</resultMap>
	
	<select id="findChildrenByParentId" parameterType="int" resultMap="ResultMapWithChildren">
		select * from GOODS_CATEGORY where parent_id = #{parentId} order by id
	</select>
	
	<select id="loadWithParents" parameterType="int" resultMap="ResultMapWithParent"
		flushCache="true">
			select * from GOODS_CATEGORY where ID = #{id}
	</select>

	<select id="get" parameterType="int" resultType="GoodsCategory"
		flushCache="true">
			select * from GOODS_CATEGORY where ID = #{id}
	</select>
	
	<select id="loadByName" resultType="GoodsCategory">
		select * from GOODS_CATEGORY where name = #{name}
	</select>
	
	<select id="loadByCode" resultType="GoodsCategory">
		select * from GOODS_CATEGORY where code = #{code}
	</select>

	<select id="findByParentId" resultType="GoodsCategory">
		select * from GOODS_CATEGORY where PARENT_ID = #{parentId} order by ID
	</select>

	<insert id="insert" parameterType="GoodsCategory">
		<selectKey resultType="int" order="BEFORE" keyProperty="id">
			select seq_id.Nextval as ID from DUAL
		</selectKey>
		insert into
		GOODS_CATEGORY(ID,NAME,CODE,PARENT_ID,NOTE,CREATED_TIME,LAST_UPDATED_TIME)
		values(#{id},#{name},#{code},#{parentId,jdbcType=NUMERIC},#{note,jdbcType=VARCHAR},sysdate,sysdate)
	</insert>

	<update id="update" parameterType="GoodsCategory">
		update GOODS_CATEGORY
		<set>
			<if test="name != null and name !=''">
				NAME = #{name,jdbcType=VARCHAR},
			</if>
			<if test="code != null and code !=''">
				CODE = #{code,jdbcType=VARCHAR},
			</if>
			<if test="parentId != null">
				PARENT_ID = #{parentId,jdbcType=NUMERIC},
			</if>
			<if test="note!= null and note !=''">
				NOTE = #{note,jdbcType=VARCHAR},
			</if>
		</set>
		where id = #{id}
	</update>

	<delete id="delete" parameterType="int">
    	<![CDATA[ delete  from GOODS_CATEGORY where ID = #{id} ]]>
	</delete>
	
	<select id="findById" resultType="GoodsCategory">
	select * from GOODS_CATEGORY WHERE ID=#{id}
	</select>
</mapper>